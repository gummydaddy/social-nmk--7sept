{% extends 'landing_page.html' %}
{% load static %}

{% block main_content %}
<div class="container">
    <h2>Edit Profile</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Save changes</button>
        <button type="button" class="btn btn-primary" id="privacy-button" data-private="{{ request.user.profile.is_private|yesno:'Private,Public' }}">
            {{ request.user.profile.is_private|yesno:'Private,Public' }}
        </button>
        <div class="text-center mt-4">
            <a href="/password_reset/" class="btn btn-primary">Reset Password</a>
        </div>
    </form>
</div>
{% endblock %}

{%block edit_profile_script%}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const privacyButton = document.getElementById('privacy-button');
    
        if (privacyButton) {
            privacyButton.addEventListener('click', function() {
                const url = "{% url 'user_profile:toggle_privacy' %}";
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken,
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({})
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        privacyButton.textContent = data.is_private ? 'Private' : 'Public';
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        }
    });
    
</script>
{%endblock%}